#!/usr/bin/env python2.7

import sys
import urllib
import feedparser
import os


def rot13(s):
    d = {}
    for c in (65, 97):
        for i in range(26):
            d[chr(i+c)] = chr((i+13) % 26 + c)
    return "".join([d.get(c, c) for c in s])


def mail(name, pwd):
    _URL = "https://mail.google.com/gmail/feed/atom"
    urllib.FancyURLopener.prompt_user_passwd = lambda self, host, realm: (name, pwd)

    #The method to do HTTPBasicAuthentication
    opener = urllib.FancyURLopener()
    f = opener.open(_URL)
    feed = f.read()
    
    #Parse the Atom feed and print a summary
    atom = feedparser.parse(feed)
    item = "%s new (%s@gmail.com)" % (len(atom.entries), name)
    
    #Parse the Atom feed and print titles and short entries
    for i in range(len(atom.entries)):
        item += atom.entries[i].title
        item += atom.entries[i].author

    return item

    
    
if __name__ == "__main__":
    #try:
        message1 = mail('teh.s0v', 'UeeukFrSov42')
        message2 = mail('cheshir.box', 'CgfcbBCj[hfyb')
        os.system('kdialog --msgbox "%s \n %s"' % (message1.encode('ascii', 'ignore'), message2.encode('ascii', 'ignore')))
        #print '\n'
    #except:
        #print "No connection to host.";

